## Bug 记录

0. （22.08.10）借助字符串的 `unicode_width` 来定位 TUI 中光标位置，但是当输入内容有中文等特殊字符时，由于字符所占字节数与显示宽度不相同，移动光标后光标所在的位置与对应字符在字符串中的位置不一定一致，此时修改字符串会导致 `panic`。

      - ```rust
        /// 1二^三
        ///
        /// ^ 表示光标，记字符串第一个字符前的位置为0，光标所在位置为 3（一个汉字的宽度是 2）
        /// 而“1二”的字节长度为 4（一个汉字的长度是 3），所以在这里插入或删除都会出错
        ```
      - **状态：已解决（22.08.12）。**

1. （22.08.12）目前确定光标位置的方法是：使用光标前的字符数量代表光标位置，计算出光标前所有字符宽度之和来定位光标。由于上下移动光标时直接加减整行的宽度，如果输入的内容有汉字等字符，上下移动光标会导致光标没有移动到当前位置的正上/下方。同时在特定的情况下光标的位置会比较异常，例如当前行尾宽度不够容纳一个汉字（记为 C），C 就被放到了下一行，这时光标可能出现在 C 上而不是 C 的前后。

    - ![光标出现在汉字上](https://s2.loli.net/2022/08/12/Pf7sx8DculpqJm5.png)
    - **状态：已解决（22.08.14），可能还需要测试。**

2. （22.08.17）客户端离线后，服务端没有删除无效的 stream，导致再次有消息需要广播时服务器 panic。

    - **状态：已解决（22.08.19）**。